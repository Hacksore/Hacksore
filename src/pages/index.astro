---
import { DEVTO_TOKEN } from "astro:env/server";
import { About } from "../components/about";
import type { Post } from "../components/post-card";
import { PostCard } from "../components/post-card";
import { Projects } from "../components/projects";
import { Social } from "../components/social";
import Layout from "../layouts/layout.astro";

const MAX_POSTS = 25;

// TODO: error handle
const latestArticles = (await fetch(
  `https://dev.to/api/articles?username=hacksore&per_page=${MAX_POSTS}&api_key=${DEVTO_TOKEN}`,
).then((res) => res.json())) as Post[];

Astro.response.headers.set("Cache-Control", "public, s-maxage=600, stale-while-revalidate=86400");
---

<Layout>
	<section class="flex justify-center">
		<About client:load />
	</section>

	<section>
		<Social client:load />
	</section>

	<section class="pb-16 md:pb-14">
		<Projects client:load />
	</section>

  <section class="mb-16 md:mb-20">
    <div class="text-center mb-12">
      <h2 class="text-4xl font-bold text-white mb-4">Latest Articles</h2>
      <p class="text-gray-400 text-lg">Thoughts, tutorials, and insights from my work</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      {latestArticles.filter((post) => post.reading_time_minutes && post.reading_time_minutes > 0 && post.cover_image).map((post) => (
        <PostCard post={post} />
      ))}
    </div>
    <div class="text-center mt-12">
      <a 
        href="https://dev.to/hacksore" 
        class="inline-flex items-center gap-2 px-6 py-3 bg-(--color-primary) text-white rounded-lg font-medium hover:bg-blue-600 transition-colors"
        target="_blank"
        rel="noopener noreferrer"
      >
        View all articles on Dev.to
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
        </svg>
      </a>
    </div>
</Layout>
