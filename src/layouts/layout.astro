---
import "../styles/global.css";

// Determine base URL with priority:
// 1. PUBLIC_SITE_URL (manual override)
// 2. VERCEL_ENV === "preview" (Vercel preview deployments) - add https:// prefix
// 3. DEV mode - localhost
// 4. Production - hacksore.com
function getBaseUrl(): string {
  if (import.meta.env.PUBLIC_SITE_URL) {
    return import.meta.env.PUBLIC_SITE_URL;
  }

  if (import.meta.env.VERCEL_ENV === "preview" && import.meta.env.VERCEL_URL) {
    return `https://${import.meta.env.VERCEL_URL}`;
  }

  if (import.meta.env.DEV) {
    return "http://localhost:4321";
  }

  // Default to production URL
  return "https://hacksore.com";
}

const BASE_URL = getBaseUrl();

function getOgImageUrl(url: string): string {
  if (url.startsWith("http://") || url.startsWith("https://")) {
    return url;
  }

  const cleanPath = url.startsWith("/") ? url : `/${url}`;
  return `${BASE_URL}${cleanPath}`;
}

const {
  title = "Sean Boult - Portfolio Site",
  description = "Full Stack Developer Who Likes React",
  ogImage = "/img/og.png",
} = Astro.props;

const ogImageUrl = getOgImageUrl(ogImage);

const META_INFO = {
  title,
  description,
  ogImage: ogImageUrl,
};
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{META_INFO.title}</title>
		<meta name="description" content={META_INFO.description} />
		<meta property="og:title" content={META_INFO.title} />
		<meta property="og:description" content={META_INFO.description} />
		<meta property="og:image" content={ogImageUrl} />
		<meta property="og:type" content="website" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={META_INFO.title} />
		<meta name="twitter:description" content={META_INFO.description} />
		<meta name="twitter:image" content={ogImageUrl} />
		<link rel="preconnect" href="https://giscus.app" />
	</head>
	<body>
		<main class="max-w-3xl my-10 mx-auto pb-16 md:pb-24">
		  <slot />
      <div class="giscus-container px-4 md:px-0">
        <script
          src="https://giscus.app/client.js"
          data-repo="Hacksore/Hacksore"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyNzg0MzA5NzM="
          data-mapping="title"
          data-strict="0"
          data-category="General"
          data-category-id="DIC_kwDOEJiE_c4CSRHB"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="preferred_color_scheme"
          data-lang="en"
          crossorigin="anonymous"
          async
        >
        </script>
      </div>
		</main>
	</body>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}

	/* Add padding to giscus container on mobile */
	.giscus-container {
		margin-top: 2rem;
	}

	/* Target the dynamically generated giscus element */
	.giscus,
	.giscus-container > iframe {
		max-width: 100%;
	}
</style>
